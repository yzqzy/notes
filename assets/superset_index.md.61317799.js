import{_ as s,o as n,c as a,Q as p}from"./chunks/framework.9bc09dc8.js";const l="/assets/example01.0122c85f.png",o="/assets/error01.59b2f81d.png",e="/assets/error02.f214733b.png",t="/assets/error03.2fe40947.png",c="/assets/example02.791b9799.png",r="/assets/example03.d2d0d82d.png",m=JSON.parse('{"title":"superset 开发环境搭建","description":"","frontmatter":{},"headers":[],"relativePath":"superset/index.md","filePath":"superset/index.md"}'),E={name:"superset/index.md"},y=p(`<h1 id="superset-开发环境搭建" tabindex="-1">superset 开发环境搭建 <a class="header-anchor" href="#superset-开发环境搭建" aria-label="Permalink to &quot;superset 开发环境搭建&quot;">​</a></h1><p>搭建前端本地开发环境有很多坑，官网文档写的模糊不清，百度、chrome 教程早已过时很久。</p><p>本次基于官网最新 <a href="https://github.com/apache/superset/releases/tag/1.4.2" target="_blank" rel="noreferrer">superset 1.4.2</a> 版本进行环境搭建。下面是官方教程，仅供参考，有很多坑。</p><p><a href="https://superset.apache.org/docs/installation/installing-superset-from-scratch%E3%80%82" target="_blank" rel="noreferrer">https://superset.apache.org/docs/installation/installing-superset-from-scratch。</a></p><h2 id="安装-python-环境" tabindex="-1">安装 python 环境 <a class="header-anchor" href="#安装-python-环境" aria-label="Permalink to &quot;安装 python 环境&quot;">​</a></h2><p>Python 自带 pip 打包管理工具，安装时需要将 python 添加到 path 中。</p><p>Python 版本不得高于 3.9.0，高于此版本部署虚拟环境会有问题。</p><blockquote><p><a href="https://www.python.org/downloads/release/python-390/" target="_blank" rel="noreferrer">https://www.python.org/downloads/release/python-390/</a></p></blockquote><h2 id="下载-superset-源码" tabindex="-1">下载 superset 源码 <a class="header-anchor" href="#下载-superset-源码" aria-label="Permalink to &quot;下载 superset 源码&quot;">​</a></h2><p><a href="https://github.com/apache/superset/releases/tag/1.4.2" target="_blank" rel="noreferrer">https://github.com/apache/superset/releases/tag/1.4.2</a></p><p><a href="https://github.com/apache/superset/archive/refs/tags/1.4.2.zip" target="_blank" rel="noreferrer">Source code(zip)</a></p><h2 id="部署-python-虚拟环境" tabindex="-1">部署 python 虚拟环境 <a class="header-anchor" href="#部署-python-虚拟环境" aria-label="Permalink to &quot;部署 python 虚拟环境&quot;">​</a></h2><blockquote><p>命令最好使用 cmd，bash 创建用户时有问题。</p></blockquote><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pip install virtualenv</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pip install virtualenv</span></span></code></pre></div><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">virtualenv env</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">virtualenv env</span></span></code></pre></div><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">env\\Scripts\\activate</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">env\\Scripts\\activate</span></span></code></pre></div><h2 id="安装、初始化-superset" tabindex="-1">安装、初始化 superset <a class="header-anchor" href="#安装、初始化-superset" aria-label="Permalink to &quot;安装、初始化 superset&quot;">​</a></h2><p>解压之前下载的 superset 源码，进入到源码目录。</p><p>设置 pip 国内源地址。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pip config set global.index</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">url </span><span style="color:#B392F0;">https</span><span style="color:#E1E4E8;">:</span><span style="color:#6A737D;">//pypi.tuna.tsinghua.edu.cn/simple</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pip config set global.index</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">url </span><span style="color:#6F42C1;">https</span><span style="color:#24292E;">:</span><span style="color:#6A737D;">//pypi.tuna.tsinghua.edu.cn/simple</span></span></code></pre></div><p>安装 superset 本地测试依赖</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pip install </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e .</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pip install </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e .</span></span></code></pre></div><p><s>安装 apache-superset，非必须，不执行本行命令也可以。</s></p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pip install apache</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">superset</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pip install apache</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">superset</span></span></code></pre></div><p>初始化数据库</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">superset db upgrade</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">superset db upgrade</span></span></code></pre></div><p>创建用户并初始化配置</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">superset fab create</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admin </span><span style="color:#6A737D;">// 默认用户名 admin，密码  admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">superset load_examples </span><span style="color:#6A737D;">// 下载 superset 案例，需要安全上网</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">superset init</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">superset fab create</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">admin </span><span style="color:#6A737D;">// 默认用户名 admin，密码  admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">superset load_examples </span><span style="color:#6A737D;">// 下载 superset 案例，需要安全上网</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">superset init</span></span></code></pre></div><p>启动 superset server</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">superset run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">3000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--with-</span><span style="color:#E1E4E8;">threads </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">reload </span><span style="color:#F97583;">--debugger</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">superset run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">3000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--with-</span><span style="color:#24292E;">threads </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">reload </span><span style="color:#D73A49;">--debugger</span></span></code></pre></div><p>访问地址，会发现页面空白，这是因为前端资源并没有构建好。</p><p>开发环境是热更新，需要同时启动两个服务。一个是服务端的服务 ，一个是前端的打包服务，修改前端的代码时，前端的代码会实时的打包更新到 <code>superset/static/assets</code> 文件夹下，服务端根据这个文件夹内的文件对前端的页面进行渲染。</p><h2 id="前端项目环境配置" tabindex="-1">前端项目环境配置 <a class="header-anchor" href="#前端项目环境配置" aria-label="Permalink to &quot;前端项目环境配置&quot;">​</a></h2><p>安装项目依赖</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">cd superset</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">frontend</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">npm install</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">cd superset</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">frontend</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">npm install</span></span></code></pre></div><p>修改 webpack 配置</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">:</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">jsx</span><span style="color:#F97583;">?$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// include source code for plugins, but exclude node_modules and test files within them</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">exclude</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">node_modules</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">test</span><span style="color:#79B8FF;">.</span><span style="color:#DBEDFF;">jsx</span><span style="color:#F97583;">?$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">include</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#9ECBFF;">}/src\`</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">src</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#9ECBFF;">}/.storybook\`</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;src&#39;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// 添加本行代码，对 windows 环境不友好</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">: [babelLoader],</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">test</span><span style="color:#24292E;">:</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">jsx</span><span style="color:#D73A49;">?$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// include source code for plugins, but exclude node_modules and test files within them</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">exclude</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">/superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">node_modules</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">test</span><span style="color:#005CC5;">.</span><span style="color:#032F62;">jsx</span><span style="color:#D73A49;">?$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">include</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`\${</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#032F62;">}/src\`</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">/superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">src/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`\${</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#032F62;">}/.storybook\`</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&#39;src&#39;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// 添加本行代码，对 windows 环境不友好</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">: [babelLoader],</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>运行项目</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">npm run dev</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">npm run dev</span></span></code></pre></div><img src="`+l+'"><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>搭建好开发环境后，我们就可以做更多事情。例如对 superset 进行二次开发，自定义页面内容，样式等。</p><p>项目开发完毕后，运行 <code>npm run build</code> 命令编译线上资源。 将 <code>superset\\static\\assets</code> 目录的资源提供给后端开发人员就可以正常部署使用。</p><h2 id="fix" tabindex="-1">Fix <a class="header-anchor" href="#fix" aria-label="Permalink to &quot;Fix&quot;">​</a></h2><h2 id="钉钉移动端不能正常访问" tabindex="-1">钉钉移动端不能正常访问 <a class="header-anchor" href="#钉钉移动端不能正常访问" aria-label="Permalink to &quot;钉钉移动端不能正常访问&quot;">​</a></h2><p>安卓端 钉钉微应用在使用 superset 时，会发现页面一直处于 loading 状态。</p><p>通过 <a href="https://www.charlesproxy.com/" target="_blank" rel="noreferrer">charles </a>抓包会发现前端资源并没有正常加载。</p><blockquote><p>安装教程：<a href="https://www.cnblogs.com/hancel/p/11245286.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/hancel/p/11245286.html</a></p></blockquote><p>通过 chrome 提供的 <a href="https://developer.chrome.com/docs/devtools/remote-debugging/" target="_blank" rel="noreferrer">调试工具</a> 以及钉钉提供的 <a href="https://open.dingtalk.com/document/resourcedownload/h5-debug" target="_blank" rel="noreferrer">android 调试工具</a> 可以看到。</p><blockquote><p>chrome 调试工具需要翻墙才可以正常使用。</p></blockquote><img src="'+o+`"><p>这其实是因为钉钉使用的浏览器版本并不支持 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis#browser_compatibility%EF%BC%89" target="_blank" rel="noreferrer">globalThis </a>。 从 MDN 文档可以得到，其实 globalThis 其实就是指向 window，解决方案也很简单。</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.globalThis </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.globalThis </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);      </span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.globalThis </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.globalThis </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">);      </span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>我们可以在 <code>superset\\templates\\superset\\basic.html</code> 文件中添加上述代码。</p><p>这个问题解决之后，刷新浏览器发现还会报错。</p><img src="`+e+`"><p>错误的含义就是浏览器不能解析 <code>@superset-ui/core/esm/connection/SupersetClientClass.js</code>文件。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// @superset-ui/core/esm/connection/SupersetClientClass.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Licensed to the Apache Software Foundation (ASF) under one</span></span>
<span class="line"><span style="color:#6A737D;"> * or more contributor license agreements.  See the NOTICE file</span></span>
<span class="line"><span style="color:#6A737D;"> * distributed with this work for additional information</span></span>
<span class="line"><span style="color:#6A737D;"> * regarding copyright ownership.  The ASF licenses this file</span></span>
<span class="line"><span style="color:#6A737D;"> * to you under the Apache License, Version 2.0 (the</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;License&quot;); you may not use this file except in compliance</span></span>
<span class="line"><span style="color:#6A737D;"> * with the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> *   http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * Unless required by applicable law or agreed to in writing,</span></span>
<span class="line"><span style="color:#6A737D;"> * software distributed under the License is distributed on an</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span>
<span class="line"><span style="color:#6A737D;"> * KIND, either express or implied.  See the License for the</span></span>
<span class="line"><span style="color:#6A737D;"> * specific language governing permissions and limitations</span></span>
<span class="line"><span style="color:#6A737D;"> * under the License.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> callApiAndParseWithTimeout </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./callApi/callApiAndParseWithTimeout&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { DEFAULT_FETCH_RETRY_OPTIONS, DEFAULT_BASE_URL } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./constants&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SupersetClientClass</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">request</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">credentials</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">mode</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">endpoint</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">host</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">url</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">headers</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">timeout</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">fetchRetryOptions</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">...</span><span style="color:#FFAB70;">rest</span></span>
<span class="line"><span style="color:#E1E4E8;">  }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">ensureAuth</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">callApiAndParseWithTimeout</span><span style="color:#E1E4E8;">({ </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">rest,</span></span>
<span class="line"><span style="color:#E1E4E8;">      credentials: credentials </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.credentials,</span></span>
<span class="line"><span style="color:#E1E4E8;">      mode: mode </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.mode,</span></span>
<span class="line"><span style="color:#E1E4E8;">      url: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getUrl</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        endpoint,</span></span>
<span class="line"><span style="color:#E1E4E8;">        host,</span></span>
<span class="line"><span style="color:#E1E4E8;">        url</span></span>
<span class="line"><span style="color:#E1E4E8;">      }),</span></span>
<span class="line"><span style="color:#E1E4E8;">      headers: { </span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.headers,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">headers</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      timeout: timeout </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.timeout,</span></span>
<span class="line"><span style="color:#E1E4E8;">      fetchRetryOptions: fetchRetryOptions </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.fetchRetryOptions</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ensureAuth</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.csrfPromise </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// eslint-disable-next-line prefer-promise-reject-errors</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">      error: </span><span style="color:#9ECBFF;">\`SupersetClient has not been provided a CSRF token, ensure it is</span></span>
<span class="line"><span style="color:#9ECBFF;">        initialized with </span><span style="color:#79B8FF;">\\\`</span><span style="color:#9ECBFF;">client.getCSRFToken()</span><span style="color:#79B8FF;">\\\`</span><span style="color:#9ECBFF;"> or try logging in at</span></span>
<span class="line"><span style="color:#9ECBFF;">        \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">getUrl</span><span style="color:#9ECBFF;">({</span></span>
<span class="line"><span style="color:#9ECBFF;">        endpoint: </span><span style="color:#9ECBFF;">&#39;/login&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">      })</span><span style="color:#9ECBFF;">}\`</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">getUrl</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">inputHost</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">url</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> url </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;string&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> url;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> inputHost </span><span style="color:#F97583;">??</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.host;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cleanHost</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> host.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> host.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> host; </span><span style="color:#6A737D;">// no backslash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">protocol</span><span style="color:#9ECBFF;">}//\${</span><span style="color:#E1E4E8;">cleanHost</span><span style="color:#9ECBFF;">}/\${</span><span style="color:#E1E4E8;">endpoint</span><span style="color:#9ECBFF;">[</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">] </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> </span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">?</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">endpoint</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">slice</span><span style="color:#9ECBFF;">(</span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">) </span><span style="color:#F97583;">:</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">endpoint</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// @superset-ui/core/esm/connection/SupersetClientClass.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Licensed to the Apache Software Foundation (ASF) under one</span></span>
<span class="line"><span style="color:#6A737D;"> * or more contributor license agreements.  See the NOTICE file</span></span>
<span class="line"><span style="color:#6A737D;"> * distributed with this work for additional information</span></span>
<span class="line"><span style="color:#6A737D;"> * regarding copyright ownership.  The ASF licenses this file</span></span>
<span class="line"><span style="color:#6A737D;"> * to you under the Apache License, Version 2.0 (the</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;License&quot;); you may not use this file except in compliance</span></span>
<span class="line"><span style="color:#6A737D;"> * with the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> *   http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * Unless required by applicable law or agreed to in writing,</span></span>
<span class="line"><span style="color:#6A737D;"> * software distributed under the License is distributed on an</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span>
<span class="line"><span style="color:#6A737D;"> * KIND, either express or implied.  See the License for the</span></span>
<span class="line"><span style="color:#6A737D;"> * specific language governing permissions and limitations</span></span>
<span class="line"><span style="color:#6A737D;"> * under the License.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> callApiAndParseWithTimeout </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./callApi/callApiAndParseWithTimeout&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { DEFAULT_FETCH_RETRY_OPTIONS, DEFAULT_BASE_URL } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./constants&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SupersetClientClass</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">request</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">credentials</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">mode</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">endpoint</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">host</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">url</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">headers</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">timeout</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">fetchRetryOptions</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">...</span><span style="color:#E36209;">rest</span></span>
<span class="line"><span style="color:#24292E;">  }) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">ensureAuth</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">callApiAndParseWithTimeout</span><span style="color:#24292E;">({ </span><span style="color:#D73A49;">...</span><span style="color:#24292E;">rest,</span></span>
<span class="line"><span style="color:#24292E;">      credentials: credentials </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.credentials,</span></span>
<span class="line"><span style="color:#24292E;">      mode: mode </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.mode,</span></span>
<span class="line"><span style="color:#24292E;">      url: </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getUrl</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        endpoint,</span></span>
<span class="line"><span style="color:#24292E;">        host,</span></span>
<span class="line"><span style="color:#24292E;">        url</span></span>
<span class="line"><span style="color:#24292E;">      }),</span></span>
<span class="line"><span style="color:#24292E;">      headers: { </span><span style="color:#D73A49;">...</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.headers,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">...</span><span style="color:#24292E;">headers</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      timeout: timeout </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.timeout,</span></span>
<span class="line"><span style="color:#24292E;">      fetchRetryOptions: fetchRetryOptions </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.fetchRetryOptions</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ensureAuth</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.csrfPromise </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// eslint-disable-next-line prefer-promise-reject-errors</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">      error: </span><span style="color:#032F62;">\`SupersetClient has not been provided a CSRF token, ensure it is</span></span>
<span class="line"><span style="color:#032F62;">        initialized with </span><span style="color:#005CC5;">\\\`</span><span style="color:#032F62;">client.getCSRFToken()</span><span style="color:#005CC5;">\\\`</span><span style="color:#032F62;"> or try logging in at</span></span>
<span class="line"><span style="color:#032F62;">        \${</span><span style="color:#005CC5;">this</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">getUrl</span><span style="color:#032F62;">({</span></span>
<span class="line"><span style="color:#032F62;">        endpoint: </span><span style="color:#032F62;">&#39;/login&#39;</span></span>
<span class="line"><span style="color:#032F62;">      })</span><span style="color:#032F62;">}\`</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">getUrl</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">host</span><span style="color:#24292E;">: </span><span style="color:#E36209;">inputHost</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">url</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {}) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">typeof</span><span style="color:#24292E;"> url </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;string&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> url;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">host</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> inputHost </span><span style="color:#D73A49;">??</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.host;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cleanHost</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> host.</span><span style="color:#6F42C1;">slice</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> host.</span><span style="color:#6F42C1;">slice</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> host; </span><span style="color:#6A737D;">// no backslash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#005CC5;">this</span><span style="color:#032F62;">.</span><span style="color:#24292E;">protocol</span><span style="color:#032F62;">}//\${</span><span style="color:#24292E;">cleanHost</span><span style="color:#032F62;">}/\${</span><span style="color:#24292E;">endpoint</span><span style="color:#032F62;">[</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">] </span><span style="color:#D73A49;">===</span><span style="color:#032F62;"> </span><span style="color:#032F62;">&#39;/&#39;</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">?</span><span style="color:#032F62;"> </span><span style="color:#24292E;">endpoint</span><span style="color:#032F62;">.</span><span style="color:#6F42C1;">slice</span><span style="color:#032F62;">(</span><span style="color:#005CC5;">1</span><span style="color:#032F62;">) </span><span style="color:#D73A49;">:</span><span style="color:#032F62;"> </span><span style="color:#24292E;">endpoint</span><span style="color:#032F62;">}\`</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>问题其实是浏览器无法解析<code>??</code>，<code>??</code>这其实也是 ES 的一个新特性，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_nullish_assignment" target="_blank" rel="noreferrer">空值合并运算符</a>。我们可以这样解决它。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\webpack.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">  context: </span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// to automatically find tsconfig.json</span></span>
<span class="line"><span style="color:#E1E4E8;">  module: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    rules: [</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">      {</span></span>
<span class="line"><span style="color:#E1E4E8;">        test:</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">jsx</span><span style="color:#F97583;">?$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// include source code for plugins, but exclude node_modules and test files within them</span></span>
<span class="line"><span style="color:#E1E4E8;">        exclude: [</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">node_modules</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">test</span><span style="color:#79B8FF;">.</span><span style="color:#DBEDFF;">jsx</span><span style="color:#F97583;">?$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        include: [</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#9ECBFF;">}/src\`</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">src</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#9ECBFF;">}/.storybook\`</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">          path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;src&#39;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// 添加本行代码，对 windows 环境不友好</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">@encodable</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">        use: [babelLoader],</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 新增解析规则</span></span>
<span class="line"><span style="color:#E1E4E8;">      {</span></span>
<span class="line"><span style="color:#E1E4E8;">        test:</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">js</span><span style="color:#F97583;">$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        exclude: [</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">node_modules</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">test</span><span style="color:#79B8FF;">.</span><span style="color:#DBEDFF;">jsx</span><span style="color:#F97583;">?$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        include: [</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        use: [</span></span>
<span class="line"><span style="color:#E1E4E8;">          {</span></span>
<span class="line"><span style="color:#E1E4E8;">            loader: </span><span style="color:#9ECBFF;">&#39;babel-loader&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            options: {</span></span>
<span class="line"><span style="color:#E1E4E8;">              cacheDirectory: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#6A737D;">// disable gzip compression for cache files</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#6A737D;">// faster when there are millions of small files</span></span>
<span class="line"><span style="color:#E1E4E8;">              cacheCompression: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">              presets: [[</span><span style="color:#9ECBFF;">&#39;@babel/preset-env&#39;</span><span style="color:#E1E4E8;">]],</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">          },</span></span>
<span class="line"><span style="color:#E1E4E8;">        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      {</span></span>
<span class="line"><span style="color:#E1E4E8;">        test:</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">css</span><span style="color:#F97583;">$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        include: [</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#E1E4E8;">,</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">superset-ui</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">+</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">src</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        use: [</span></span>
<span class="line"><span style="color:#E1E4E8;">          isDevMode </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;style-loader&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> MiniCssExtractPlugin.loader,</span></span>
<span class="line"><span style="color:#E1E4E8;">          {</span></span>
<span class="line"><span style="color:#E1E4E8;">            loader: </span><span style="color:#9ECBFF;">&#39;css-loader&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            options: {</span></span>
<span class="line"><span style="color:#E1E4E8;">              sourceMap: isDevMode,</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">          },</span></span>
<span class="line"><span style="color:#E1E4E8;">        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">      },</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">    ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\webpack.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">  context: </span><span style="color:#005CC5;">APP_DIR</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// to automatically find tsconfig.json</span></span>
<span class="line"><span style="color:#24292E;">  module: {</span></span>
<span class="line"><span style="color:#24292E;">    rules: [</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">      {</span></span>
<span class="line"><span style="color:#24292E;">        test:</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">jsx</span><span style="color:#D73A49;">?$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// include source code for plugins, but exclude node_modules and test files within them</span></span>
<span class="line"><span style="color:#24292E;">        exclude: [</span><span style="color:#032F62;">/superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">node_modules</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">test</span><span style="color:#005CC5;">.</span><span style="color:#032F62;">jsx</span><span style="color:#D73A49;">?$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        include: [</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`\${</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#032F62;">}/src\`</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">/superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">src/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`\${</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#032F62;">}/.storybook\`</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">          path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&#39;src&#39;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// 添加本行代码，对 windows 环境不友好</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">/@encodable/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">        use: [babelLoader],</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 新增解析规则</span></span>
<span class="line"><span style="color:#24292E;">      {</span></span>
<span class="line"><span style="color:#24292E;">        test:</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">js</span><span style="color:#D73A49;">$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        exclude: [</span><span style="color:#032F62;">/superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">node_modules</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">test</span><span style="color:#005CC5;">.</span><span style="color:#032F62;">jsx</span><span style="color:#D73A49;">?$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        include: [</span><span style="color:#032F62;">/superset-ui/</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        use: [</span></span>
<span class="line"><span style="color:#24292E;">          {</span></span>
<span class="line"><span style="color:#24292E;">            loader: </span><span style="color:#032F62;">&#39;babel-loader&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            options: {</span></span>
<span class="line"><span style="color:#24292E;">              cacheDirectory: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6A737D;">// disable gzip compression for cache files</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6A737D;">// faster when there are millions of small files</span></span>
<span class="line"><span style="color:#24292E;">              cacheCompression: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">              presets: [[</span><span style="color:#032F62;">&#39;@babel/preset-env&#39;</span><span style="color:#24292E;">]],</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">          },</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      {</span></span>
<span class="line"><span style="color:#24292E;">        test:</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">css</span><span style="color:#D73A49;">$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        include: [</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#24292E;">,</span><span style="color:#032F62;"> /superset-ui</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">+</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">src/</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        use: [</span></span>
<span class="line"><span style="color:#24292E;">          isDevMode </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;style-loader&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> MiniCssExtractPlugin.loader,</span></span>
<span class="line"><span style="color:#24292E;">          {</span></span>
<span class="line"><span style="color:#24292E;">            loader: </span><span style="color:#032F62;">&#39;css-loader&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            options: {</span></span>
<span class="line"><span style="color:#24292E;">              sourceMap: isDevMode,</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">          },</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">      },</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>解决上述问题，刷新页面会发现还有问题。</p><img src="`+t+`"><p>这个问题显而易见，浏览器无法解析 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries" target="_blank" rel="noreferrer"> Object.fromEntries</a> 对象。我们需要手动引入 polyfill 。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\webpack.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">PREAMBLE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;/src/preamble.ts&#39;</span><span style="color:#E1E4E8;">)];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  entry: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    preamble: </span><span style="color:#79B8FF;">PREAMBLE</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    theme: path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;/src/theme.ts&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    menu: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;src/views/menu.tsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    spa: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/src/views/index.tsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    addSlice: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/src/addSlice/index.tsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    explore: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/src/explore/index.jsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    sqllab: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/src/SqlLab/index.tsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    profile: </span><span style="color:#B392F0;">addPreamble</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/src/profile/index.tsx&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    showSavedQuery: [path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">APP_DIR</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;/src/showSavedQuery/index.jsx&#39;</span><span style="color:#E1E4E8;">)],</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\webpack.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">PREAMBLE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;/src/preamble.ts&#39;</span><span style="color:#24292E;">)];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  entry: {</span></span>
<span class="line"><span style="color:#24292E;">    preamble: </span><span style="color:#005CC5;">PREAMBLE</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    theme: path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;/src/theme.ts&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    menu: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;src/views/menu.tsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    spa: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/src/views/index.tsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    addSlice: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/src/addSlice/index.tsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    explore: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/src/explore/index.jsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    sqllab: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/src/SqlLab/index.tsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    profile: </span><span style="color:#6F42C1;">addPreamble</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/src/profile/index.tsx&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    showSavedQuery: [path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">APP_DIR</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;/src/showSavedQuery/index.jsx&#39;</span><span style="color:#24292E;">)],</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>从 webpack.config.js 文件可以看到，superset 定义了多个入口，我们可以在 <code>preamble</code>中引入 polyfill。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\src\\preamble.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Licensed to the Apache Software Foundation (ASF) under one</span></span>
<span class="line"><span style="color:#6A737D;"> * or more contributor license agreements.  See the NOTICE file</span></span>
<span class="line"><span style="color:#6A737D;"> * distributed with this work for additional information</span></span>
<span class="line"><span style="color:#6A737D;"> * regarding copyright ownership.  The ASF licenses this file</span></span>
<span class="line"><span style="color:#6A737D;"> * to you under the Apache License, Version 2.0 (the</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;License&quot;); you may not use this file except in compliance</span></span>
<span class="line"><span style="color:#6A737D;"> * with the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> *   http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * Unless required by applicable law or agreed to in writing,</span></span>
<span class="line"><span style="color:#6A737D;"> * software distributed under the License is distributed on an</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span>
<span class="line"><span style="color:#6A737D;"> * KIND, either express or implied.  See the License for the</span></span>
<span class="line"><span style="color:#6A737D;"> * specific language governing permissions and limitations</span></span>
<span class="line"><span style="color:#6A737D;"> * under the License.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { setConfig </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> setHotLoaderConfig } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;react-hot-loader&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;abortcontroller-polyfill/dist/abortcontroller-polyfill-only&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;core-js/features/object/from-entries&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 新增代码</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> moment </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;moment&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { configure, supersetTheme } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@superset-ui/core&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { merge } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;lodash&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> setupClient </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./setup/setupClient&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> setupColors </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./setup/setupColors&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> setupFormatters </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./setup/setupFormatters&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// superset-frontend\\src\\preamble.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Licensed to the Apache Software Foundation (ASF) under one</span></span>
<span class="line"><span style="color:#6A737D;"> * or more contributor license agreements.  See the NOTICE file</span></span>
<span class="line"><span style="color:#6A737D;"> * distributed with this work for additional information</span></span>
<span class="line"><span style="color:#6A737D;"> * regarding copyright ownership.  The ASF licenses this file</span></span>
<span class="line"><span style="color:#6A737D;"> * to you under the Apache License, Version 2.0 (the</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;License&quot;); you may not use this file except in compliance</span></span>
<span class="line"><span style="color:#6A737D;"> * with the License.  You may obtain a copy of the License at</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> *   http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * Unless required by applicable law or agreed to in writing,</span></span>
<span class="line"><span style="color:#6A737D;"> * software distributed under the License is distributed on an</span></span>
<span class="line"><span style="color:#6A737D;"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span>
<span class="line"><span style="color:#6A737D;"> * KIND, either express or implied.  See the License for the</span></span>
<span class="line"><span style="color:#6A737D;"> * specific language governing permissions and limitations</span></span>
<span class="line"><span style="color:#6A737D;"> * under the License.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { setConfig </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> setHotLoaderConfig } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;react-hot-loader&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;abortcontroller-polyfill/dist/abortcontroller-polyfill-only&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;core-js/features/object/from-entries&#39;</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// 新增代码</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> moment </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;moment&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { configure, supersetTheme } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@superset-ui/core&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { merge } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;lodash&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> setupClient </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./setup/setupClient&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> setupColors </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./setup/setupColors&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> setupFormatters </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./setup/setupFormatters&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><p>重新刷新页面，大功告成。。。</p><img src="`+c+'"><img src="'+r+'"><p>中间还有其他一些不重要的问题给略过了，至此我们又可以使用 superset 开心的玩耍了。</p>',70),i=[y];function F(d,h,u,D,A,g){return n(),a("div",null,i)}const b=s(E,[["render",F]]);export{m as __pageData,b as default};
