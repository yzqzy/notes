{"version":3,"sources":["../src/node/cli.ts","../src/node/server/index.ts","../src/node/optimizer/index.ts","../src/node/constants.ts","../src/node/optimizer/scanPlugin.ts","../src/node/optimizer/preBundlePlugin.ts","../src/node/utils.ts","../src/node/plugins/resolve.ts","../src/node/plugins/esbuild.ts","../src/node/plugins/importAnalysis.ts","../src/node/plugins/css.ts","../src/node/plugins/assets.ts","../src/node/plugins/index.ts","../src/node/pluginContainer.ts","../src/node/server/middlewares/indexHtml.ts","../src/node/server/middlewares/transform.ts","../src/node/server/middlewares/static.ts"],"sourcesContent":["import cac from \"cac\"\r\nimport { startDevServer } from \"./server\"\r\n\r\nconst cli = cac()\r\n\r\ncli\r\n  .command(\"[root]\", \"Run the development server\")\r\n  .alias(\"serve\")\r\n  .alias(\"dev\")\r\n  .action(async () => {\r\n    await startDevServer()\r\n  })\r\n\r\ncli.help()\r\n\r\ncli.parse()\r\n","import connect from \"connect\"\r\nimport { blue, green } from \"picocolors\"\r\n\r\nimport { optimize } from '../optimizer'\r\nimport { resolvePlugins } from '../plugins'\r\nimport { Plugin } from \"../plugin\";\r\nimport { createPluginContainer, PluginContainer } from '../pluginContainer'\r\n\r\nimport { indexHtmlMiddware } from './middlewares/indexHtml'\r\nimport { transformMiddleware } from \"./middlewares/transform\"\r\nimport { staticMiddleware } from \"./middlewares/static\"\r\n\r\nexport interface ServerContext {\r\n  root: string;\r\n  pluginContainer: PluginContainer;\r\n  app: connect.Server;\r\n  plugins: Plugin[]\r\n}\r\n\r\nexport async function startDevServer() {\r\n  const app = connect()\r\n  const root = process.cwd()\r\n  const startTime = Date.now()\r\n\r\n  const plugins = resolvePlugins()\r\n  const pluginContainer = createPluginContainer(plugins)\r\n\r\n  const serverContext: ServerContext = {\r\n    root: process.cwd(),\r\n    app,\r\n    pluginContainer,\r\n    plugins\r\n  }\r\n\r\n  for (const plugin of plugins) {\r\n    if (plugin.configureServer) {\r\n      await plugin.configureServer(serverContext)\r\n    }\r\n  }\r\n\r\n  // Ê†∏ÂøÉÁºñËØëÈÄªËæë\r\n  app.use(transformMiddleware(serverContext))\r\n  // Â§ÑÁêÜÂÖ•Âè£ HTML ËµÑÊ∫ê\r\n  app.use(indexHtmlMiddware(serverContext))\r\n  // Â§ÑÁêÜÈùôÊÄÅËµÑÊ∫ê\r\n  app.use(staticMiddleware())\r\n\r\n  app.listen(3000, async () => {\r\n    await optimize(root)\r\n\r\n    console.log(\r\n      green(\"üöÄ No-Bundle ÊúçÂä°Â∑≤ÁªèÊàêÂäüÂêØÂä®!\"),\r\n      `ËÄóÊó∂: ${Date.now() - startTime}ms`\r\n    )\r\n    console.log(`> Êú¨Âú∞ËÆøÈóÆË∑ØÂæÑ: ${blue(\"http://localhost:3000\")}`)\r\n  })\r\n}\r\n","import path from 'path'\r\nimport { build } from \"esbuild\";\r\nimport { green } from 'picocolors'\r\nimport { scanPlugin } from './scanPlugin'\r\n\r\nimport { preBundlePlugin } from \"./preBundlePlugin\";\r\nimport { PRE_BUNDLE_DIR } from \"../constants\";\r\n\r\nexport async function optimize(root: string) {\r\n  // 1. Á°ÆËÆ§ÂÖ•Âè£\r\n  const entry = path.resolve(root, 'src/main.tsx')\r\n\r\n  // 2. ‰ªéÂÖ•Âè£Â§ÑÊâ´Êèè‰æùËµñ\r\n  const deps = new Set<string>()\r\n\r\n  await build({\r\n    entryPoints: [entry],\r\n    bundle: true,\r\n    write: false,\r\n    plugins: [ scanPlugin(deps) ]\r\n  })\r\n\r\n  console.log(\r\n    `${green(\"ÈúÄË¶ÅÈ¢ÑÊûÑÂª∫ÁöÑ‰æùËµñ\")}:\\n${[...deps]\r\n    .map(green)\r\n    .map((item) => `  ${item}`)\r\n    .join(\"\\n\")}`\r\n  )\r\n\r\n  // 3. È¢ÑÊûÑÂª∫‰æùËµñ\r\n  await build({\r\n    entryPoints: [...deps],\r\n    write: true,\r\n    bundle: true,\r\n    format: \"esm\",\r\n    splitting: true,\r\n    outdir: path.resolve(root, PRE_BUNDLE_DIR),\r\n    plugins: [preBundlePlugin(deps)]\r\n  })\r\n}","import path from 'path'\r\n\r\nexport const EXTERNAL_TYPES = [\r\n  \"css\",\r\n  \"less\",\r\n  \"sass\",\r\n  \"scss\",\r\n  \"styl\",\r\n  \"stylus\",\r\n  \"pcss\",\r\n  \"postcss\",\r\n  \"vue\",\r\n  \"svelte\",\r\n  \"marko\",\r\n  \"astro\",\r\n  \"png\",\r\n  \"jpe?g\",\r\n  \"gif\",\r\n  \"svg\",\r\n  \"ico\",\r\n  \"webp\",\r\n  \"avif\",\r\n]\r\n\r\nexport const BARE_IMPORT_RE = /^[\\w@][^:]/\r\n\r\n// È¢ÑÊûÑÂª∫‰∫ßÁâ©ÈªòËÆ§Â≠òÊîæÂú® node_modules ‰∏≠ÁöÑ .vite ÁõÆÂΩï‰∏≠\r\nexport const PRE_BUNDLE_DIR = path.join(\"node_modules\", \".vite\")\r\n\r\nexport const JS_TYPES_RE = /\\.(?:j|t)sx?$|\\.mjs$/\r\nexport const QEURY_RE = /\\?.*$/s\r\nexport const HASH_RE = /#.*$/s\r\n\r\nexport const DEFAULT_EXTERSIONS = [\".tsx\", \".ts\", \".jsx\", \"js\"];","import { Plugin } from \"esbuild\"\r\nimport { BARE_IMPORT_RE, EXTERNAL_TYPES } from \"../constants\"\r\n\r\nexport function scanPlugin(deps: Set<string>): Plugin {\r\n  return {\r\n    name: \"esbuild:scan-deps\",\r\n    setup(build) {\r\n      // ÂøΩÁï•ÁöÑÊñá‰ª∂Á±ªÂûã\r\n      build.onResolve(\r\n        { filter: new RegExp(`\\\\.(${EXTERNAL_TYPES.join(\"|\")})$`) },\r\n        (resolveInfo) => {\r\n          return {\r\n            path: resolveInfo.path,\r\n            // Êâì‰∏ä external Ê†áËÆ∞\r\n            external: true,\r\n          }\r\n        }\r\n      )\r\n      // ËÆ∞ÂΩï‰æùËµñ\r\n      build.onResolve(\r\n        {\r\n          filter: BARE_IMPORT_RE,\r\n        },\r\n        (resolveInfo) => {\r\n          const { path: id } = resolveInfo\r\n          // Êé®ÂÖ• deps ÈõÜÂêà‰∏≠\r\n          deps.add(id)\r\n          return {\r\n            path: id,\r\n            external: true,\r\n          }\r\n        }\r\n      )\r\n    }\r\n  }\r\n}","import { Loader, Plugin } from \"esbuild\"\r\nimport { BARE_IMPORT_RE } from \"../constants\"\r\n\r\n// Áî®Êù•ÂàÜÊûê es Ê®°Âùó import/export ËØ≠Âè•ÁöÑÂ∫ì\r\nimport { init, parse } from \"es-module-lexer\"\r\nimport path from \"path\"\r\n// ‰∏Ä‰∏™ÂÆûÁé∞‰∫Ü node Ë∑ØÂæÑËß£ÊûêÁÆóÊ≥ïÁöÑÂ∫ì\r\nimport resolve from \"resolve\"\r\n// ‰∏Ä‰∏™Êõ¥Âä†Â•ΩÁî®ÁöÑÊñá‰ª∂Êìç‰ΩúÂ∫ì\r\nimport fs from \"fs-extra\"\r\n// Áî®Êù•ÂºÄÂèëÊâìÂç∞ debug Êó•ÂøóÁöÑÂ∫ì\r\nimport createDebug from \"debug\"\r\n\r\nimport{ normalizePath } from '../utils'\r\n\r\nconst debug = createDebug(\"dev\")\r\n\r\nexport function preBundlePlugin(deps: Set<string>): Plugin {\r\n  return {\r\n    name: \"esbuild:pre-bundle\",\r\n    setup(build) {\r\n      build.onResolve(\r\n        {\r\n          filter: BARE_IMPORT_RE,\r\n        },\r\n        (resolveInfo) => {\r\n          const { path: id, importer } = resolveInfo\r\n          const isEntry = !importer\r\n\r\n          // ÂëΩ‰∏≠ÈúÄË¶ÅÈ¢ÑÁºñËØëÁöÑ‰æùËµñ\r\n          if (deps.has(id)) {\r\n            // Ëã•‰∏∫ÂÖ•Âè£ÔºåÂàôÊ†áËÆ∞ dep ÁöÑ \r\n            \r\n            return isEntry\r\n              ? {\r\n                  path: id,\r\n                  namespace: \"dep\",\r\n                }\r\n              : {\r\n                  // Âõ†‰∏∫Ëµ∞Âà∞ onResolve ‰∫ÜÔºåÊâÄ‰ª•ËøôÈáåÁöÑ path Â∞±ÊòØÁªùÂØπË∑ØÂæÑ‰∫Ü\r\n                  path: resolve.sync(id, { basedir: process.cwd() }),\r\n                }\r\n          }\r\n        }\r\n      )\r\n\r\n      // ÊãøÂà∞Ê†áËÆ∞ÂêéÁöÑ‰æùËµñÔºåÊûÑÈÄ†‰ª£ÁêÜÊ®°ÂùóÔºå‰∫§Áªô esbuild ÊâìÂåÖ\r\n      build.onLoad(\r\n        {\r\n          filter: /.*/,\r\n          namespace: \"dep\",\r\n        },\r\n        async (loadInfo) => {\r\n          await init\r\n          \r\n          const id = loadInfo.path\r\n          const root = process.cwd()\r\n\r\n          const entryPath = resolve.sync(id, { basedir: root })\r\n\r\n          const code = await fs.readFile(entryPath, \"utf-8\")\r\n          const [imports, exports] = await parse(code)\r\n\r\n          let relativePath = normalizePath(path.relative(root, entryPath))\r\n          if (\r\n            !relativePath.startsWith('./') &&\r\n            !relativePath.startsWith('../') &&\r\n            relativePath !== '.'\r\n          ) {\r\n            relativePath = `./${relativePath}`\r\n          }\r\n\r\n          let proxyModule = []\r\n\r\n          // cjs\r\n          if (!imports.length && !exports.length) {\r\n            // ÊûÑÈÄ†‰ª£ÁêÜÊ®°Âùó\r\n            const res = require(entryPath)\r\n            const specifiers = Object.keys(res)\r\n            proxyModule.push(\r\n              `export { ${specifiers.join(\",\")} } from \"${relativePath}\"`,\r\n              `export default require(\"${relativePath}\")`\r\n            )\r\n          } else {\r\n            // esm Ê†ºÂºèÊØîËæÉÂ•ΩÂ§ÑÁêÜÔºåexport * ÊàñËÄÖ export default Âç≥ÂèØ\r\n            if (exports.includes(\"default\")) {\r\n              proxyModule.push(`import d from \"${relativePath}\"export default d`)\r\n            }\r\n            proxyModule.push(`export * from \"${relativePath}\"`)\r\n          }\r\n          debug(\"‰ª£ÁêÜÊ®°ÂùóÂÜÖÂÆπ: %o\", proxyModule.join(\"\\n\"))\r\n          const loader = path.extname(entryPath).slice(1)\r\n\r\n          return {\r\n            loader: loader as Loader,\r\n            contents: proxyModule.join(\"\\n\"),\r\n            resolveDir: root,\r\n          }\r\n        }\r\n      )\r\n    }\r\n  }\r\n}","import path from 'path'\r\nimport os from 'os'\r\nimport { JS_TYPES_RE, HASH_RE, QEURY_RE } from './constants.ts'\r\n\r\nexport function slash(p: string): string {\r\n  return p.replace(/\\\\/g, '/')\r\n}\r\nexport const isWindows = os.platform() === 'win32'\r\n\r\nexport function normalizePath(id: string): string {\r\n  return path.posix.normalize(isWindows ? slash(id) : id)\r\n}\r\n\r\nexport const isJSRequest = (id: string): boolean => {\r\n  id = cleanUrl(id)\r\n  if (JS_TYPES_RE.test(id)) {\r\n    return true\r\n  }\r\n  if (!path.extname(id) && !id.endsWith(\"/\")) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport const isCSSRequest = (id: string): boolean =>\r\n  cleanUrl(id).endsWith(\".css\")\r\n\r\nexport const isImportRequest = (url: string): boolean =>\r\n  url.endsWith(\"?import\")\r\n\r\nexport const removeImportQuery = (url: string): string =>\r\n  url.replace(/\\?import$/, \"\")\r\n\r\nexport const cleanUrl = (url: string): string =>\r\n  url.replace(HASH_RE, \"\").replace(QEURY_RE, \"\")\r\n  ","import resolve from \"resolve\"\r\nimport path from \"path\"\r\nimport { pathExists } from \"fs-extra\"\r\n\r\nimport { Plugin } from \"../plugin\"\r\nimport { ServerContext } from \"../server/index\"\r\nimport { DEFAULT_EXTERSIONS } from \"../constants\"\r\nimport { cleanUrl } from \"../utils\"\r\n\r\nexport function resolvePlugin(): Plugin {\r\n  let serverContext: ServerContext\r\n  return {\r\n    name: \"vite:resolve\",\r\n    configureServer(s) {\r\n      // ‰øùÂ≠òÊúçÂä°Á´Ø‰∏ä‰∏ãÊñá\r\n      serverContext = s\r\n    },\r\n    async resolveId(id: string, importer?: string) {\r\n      // 1. ÁªùÂØπË∑ØÂæÑ\r\n      if (path.isAbsolute(id)) {\r\n        if (await pathExists(id)) {\r\n          return { id }\r\n        }\r\n        // Âä†‰∏ä root Ë∑ØÂæÑÂâçÁºÄÔºåÂ§ÑÁêÜ /src/main.tsx ÁöÑÊÉÖÂÜµ\r\n        id = path.join(serverContext.root, id)\r\n        if (await pathExists(id)) {\r\n          return { id }\r\n        }\r\n      }\r\n      // 2. Áõ∏ÂØπË∑ØÂæÑ\r\n      else if (id.startsWith(\".\")) {\r\n        if (!importer) {\r\n          throw new Error(\"`importer` should not be undefined\")\r\n        }\r\n        const hasExtension = path.extname(id).length > 1\r\n        let resolvedId: string\r\n        // 2.1 ÂåÖÂê´Êñá‰ª∂ÂêçÂêéÁºÄ\r\n        // Â¶Ç ./App.tsx\r\n        if (hasExtension) {\r\n          resolvedId = resolve.sync(id, { basedir: path.dirname(importer) })\r\n          if (await pathExists(resolvedId)) {\r\n            // return { id: resolvedId }\r\n            return { id }\r\n          }\r\n        } \r\n        // 2.2 ‰∏çÂåÖÂê´Êñá‰ª∂ÂêçÂêéÁºÄ\r\n        // Â¶Ç ./App\r\n        else {\r\n          // ./App -> ./App.tsx\r\n          for (const extname of DEFAULT_EXTERSIONS) {\r\n            try {\r\n              const withExtension = `${id}${extname}`\r\n              resolvedId = resolve.sync(withExtension, {\r\n                basedir: path.dirname(importer),\r\n              })\r\n              if (await pathExists(resolvedId)) {\r\n                // return { id: resolvedId }\r\n                return { id: withExtension }\r\n              }\r\n            } catch (e) {\r\n              continue\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return null\r\n    }\r\n  }\r\n}\r\n","import esbuild from \"esbuild\"\r\nimport path from \"path\"\r\nimport { readFile } from \"fs-extra\"\r\n\r\nimport { Plugin } from \"../plugin\"\r\nimport { isJSRequest } from \"../utils\"\r\n\r\nexport function esbuildTransformPlugin(): Plugin {\r\n  return {\r\n    name: \"vite:esbuild-transform\",\r\n    // Âä†ËΩΩÊ®°Âùó\r\n    async load(id) {\r\n      if (isJSRequest(id)) {\r\n        try {\r\n          const code = await readFile(id, \"utf-8\")\r\n          return code\r\n        } catch (e) {\r\n          return null\r\n        }\r\n      }\r\n    },\r\n    async transform(code, id) {\r\n      if (isJSRequest(id)) {\r\n        const extname = path.extname(id).slice(1)\r\n        const { code: transformedCode, map } = await esbuild.transform(code, {\r\n          target: \"esnext\",\r\n          format: \"esm\",\r\n          sourcemap: true,\r\n          loader: extname as \"js\" | \"ts\" | \"jsx\" | \"tsx\",\r\n        })\r\n        return {\r\n          code: transformedCode,\r\n          map,\r\n        }\r\n      }\r\n      return null\r\n    }\r\n  }\r\n}\r\n","import { pathExists } from \"fs-extra\"\r\nimport resolve from \"resolve\"\r\nimport path from \"path\"\r\n// magic-string Áî®Êù•‰ΩúÂ≠óÁ¨¶‰∏≤ÁºñËæë\r\nimport MagicString from \"magic-string\" \r\nimport { init, parse } from \"es-module-lexer\"\r\nimport { isWindows } from \"../utils\"\r\n\r\nimport {\r\n  BARE_IMPORT_RE,\r\n  DEFAULT_EXTERSIONS,\r\n  PRE_BUNDLE_DIR,\r\n} from \"../constants\"\r\nimport {\r\n  cleanUrl,\r\n  isJSRequest,\r\n  normalizePath\r\n} from \"../utils\"\r\n\r\nimport { Plugin } from \"../plugin\"\r\nimport { ServerContext } from \"../server/index\"\r\n\r\nexport function importAnalysisPlugin(): Plugin {\r\n  let serverContext: ServerContext\r\n  return {\r\n    name: \"vite:import-analysis\",\r\n    configureServer(s) {\r\n      // ‰øùÂ≠òÊúçÂä°Á´Ø‰∏ä‰∏ãÊñá\r\n      serverContext = s\r\n    },\r\n    async transform(code: string, id: string) {\r\n      // Âè™Â§ÑÁêÜ JS Áõ∏ÂÖ≥ÁöÑËØ∑Ê±Ç\r\n      if (!isJSRequest(id)) {\r\n        return null\r\n      }\r\n      await init\r\n      // Ëß£Êûê import ËØ≠Âè•\r\n      const [imports] = parse(code)\r\n      const ms = new MagicString(code)\r\n      // ÂØπÊØè‰∏Ä‰∏™ import ËØ≠Âè•‰æùÊ¨°ËøõË°åÂàÜÊûê\r\n      for (const importInfo of imports) {\r\n        // ‰∏æ‰æãËØ¥Êòé: const str = `import React from 'react'`\r\n        // str.slice(s, e) => 'react'\r\n        const { s: modStart, e: modEnd, n: modSource } = importInfo\r\n        \r\n        if (!modSource) continue\r\n\r\n        // ÈùôÊÄÅËµÑÊ∫ê\r\n        if (modSource.endsWith(\".svg\")) {\r\n          // Âä†‰∏ä ?import ÂêéÁºÄ\r\n          const prefix = id.split('\\\\').at(-2)\r\n          const resolvedUrl = normalizePath(path.join('/', prefix, modSource))\r\n\r\n          ms.overwrite(modStart, modEnd, `${resolvedUrl}?import`)\r\n          continue\r\n        }\r\n\r\n        // Á¨¨‰∏âÊñπÂ∫ì: Ë∑ØÂæÑÈáçÂÜôÂà∞È¢ÑÊûÑÂª∫‰∫ßÁâ©ÁöÑË∑ØÂæÑ\r\n        if (BARE_IMPORT_RE.test(modSource)) {\r\n          // const bundlePath = path.join(\r\n          //   serverContext.root,\r\n          //   PRE_BUNDLE_DIR,\r\n          //   `${modSource}.js`\r\n          // )\r\n          const bundlePath = normalizePath(\r\n            path.join('/', PRE_BUNDLE_DIR, `${modSource}.js`)\r\n          )\r\n          ms.overwrite(modStart, modEnd, bundlePath)\r\n        } else if (modSource.startsWith(\".\") || modSource.startsWith(\"/\")) {\r\n          // Áõ¥Êé•Ë∞ÉÁî®Êèí‰ª∂‰∏ä‰∏ãÊñáÁöÑ resolve ÊñπÊ≥ïÔºå‰ºöËá™Âä®ÁªèËøáË∑ØÂæÑËß£ÊûêÊèí‰ª∂ÁöÑÂ§ÑÁêÜ\r\n          const resolved = await this.resolve(modSource, id)\r\n          if (resolved) {\r\n            ms.overwrite(modStart, modEnd, resolved.id)\r\n          }\r\n        }\r\n      }\r\n\r\n      return {\r\n        code: ms.toString(),\r\n        // ÁîüÊàê SourceMap\r\n        map: ms.generateMap(),\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { readFile } from \"fs-extra\"\r\nimport { Plugin } from \"../plugin\"\r\n\r\nexport function cssPlugin(): Plugin {\r\n  return {\r\n    name: \"vite:css\",\r\n    load(id) {\r\n      // Âä†ËΩΩ\r\n      if (id.endsWith(\".css\")) {\r\n        return readFile(id, \"utf-8\")\r\n      }\r\n    },\r\n    // ËΩ¨Êç¢ÈÄªËæë\r\n    async transform(code, id) {\r\n      if (id.endsWith(\".css\")) {\r\n        // ÂåÖË£ÖÊàê JS Ê®°Âùó\r\n        const jsContent = `\r\n          const css = '${code.replace(/\\n/g, \"\")}'\r\n          const style = document.createElement(\"style\")\r\n          style.setAttribute(\"type\", \"text/css\")\r\n          style.innerHTML = css\r\n          document.head.appendChild(style)\r\n          export default css`.trim()\r\n        return {\r\n          code: jsContent,\r\n        }\r\n      }\r\n      return null\r\n    }\r\n  }\r\n}\r\n","import { Plugin } from \"../plugin\"\r\nimport { cleanUrl, removeImportQuery, isWindows } from \"../utils\"\r\n\r\nexport function assetPlugin(): Plugin {\r\n  return {\r\n    name: \"vite:asset\",\r\n    async load(id) {\r\n      let cleanedId = removeImportQuery(cleanUrl(id))\r\n      // ËøôÈáå‰ªÖÂ§ÑÁêÜ svg\r\n      if (cleanedId.endsWith(\".svg\")) {\r\n        if (isWindows) {\r\n          cleanedId = cleanedId.replace('D:\\\\', '').replace(/\\\\/g, '\\\\\\\\')\r\n        }\r\n\r\n        return {\r\n          // ÂåÖË£ÖÊàê‰∏Ä‰∏™ JS Ê®°Âùó\r\n          code: `export default \"${cleanedId}\"`\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Plugin } from \"../plugin\"\r\n\r\nimport { resolvePlugin } from \"./resolve\"\r\nimport { esbuildTransformPlugin } from \"./esbuild\"\r\nimport { importAnalysisPlugin } from \"./importAnalysis\"\r\nimport { cssPlugin } from \"./css\"\r\nimport { assetPlugin } from \"./assets\"\r\n\r\nexport function resolvePlugins(): Plugin[] {\r\n  return [\r\n    resolvePlugin(),\r\n    esbuildTransformPlugin(),\r\n    importAnalysisPlugin(),\r\n    cssPlugin(),\r\n    assetPlugin()\r\n  ]\r\n}\r\n","import type {\r\n  LoadResult,\r\n  PartialResolvedId,\r\n  SourceDescription,\r\n  PluginContext as RollupPluginContext,\r\n  ResolvedId,\r\n} from \"rollup\";\r\n\r\nexport interface PluginContainer {\r\n  resolveId(id: string, importer?: string): Promise<PartialResolvedId | null>;\r\n  load(id: string): Promise<LoadResult | null>;\r\n  transform(code: string, id: string): Promise<SourceDescription | null>;\r\n}\r\n\r\nexport const createPluginContainer = (plugins: Plugin[]): PluginContainer => {\r\n  // Êèí‰ª∂‰∏ä‰∏ãÊñáÂØπË±°\r\n  // @ts-ignore \r\n  class Context implements RollupPluginContext {\r\n    // ËøôÈáå‰ªÖÂÆûÁé∞‰∏ä‰∏ãÊñáÂØπË±°ÁöÑ resolve ÊñπÊ≥ï\r\n    async resolve(id: string, importer?: string) {\r\n      let out = await pluginContainer.resolveId(id, importer)\r\n      if (typeof out === \"string\") out = { id: out }\r\n      return out as ResolvedId | null\r\n    }\r\n  }\r\n\r\n  // Êèí‰ª∂ÂÆπÂô®\r\n  const pluginContainer: PluginContainer = {\r\n    async resolveId(id: string, importer?: string) {\r\n      const ctx = new Context() as any\r\n      for (const plugin of plugins) {\r\n        if (plugin.resolveId) {\r\n          const newId = await plugin.resolveId.call(ctx as any, id, importer)\r\n          if (newId) {\r\n            id = typeof newId === \"string\" ? newId : newId.id\r\n            return { id }\r\n          }\r\n        }\r\n      }\r\n      return null\r\n    },\r\n    async load(id) {\r\n      const ctx = new Context() as any\r\n      for (const plugin of plugins) {\r\n        if (plugin.load) {\r\n          const result = await plugin.load.call(ctx, id)\r\n          if (result) {\r\n            return result\r\n          }\r\n        }\r\n      }\r\n      return null\r\n    },\r\n    async transform(code, id) {\r\n      const ctx = new Context() as any\r\n      for (const plugin of plugins) {\r\n        if (plugin.transform) {\r\n          const result = await plugin.transform.call(ctx, code, id)\r\n          if (!result) continue\r\n          if (typeof result === \"string\") {\r\n            code = result\r\n          } else if (result.code) {\r\n            code = result.code\r\n          }\r\n        }\r\n      }\r\n      return { code }\r\n    }\r\n  }\r\n\r\n  return pluginContainer\r\n}\r\n","import { NextHandleFunction } from \"connect\"\r\nimport path from \"path\"\r\nimport { pathExists, readFile } from \"fs-extra\"\r\nimport { ServerContext } from \"../index\"\r\n\r\nexport function indexHtmlMiddware(\r\n  serverContext: ServerContext\r\n): NextHandleFunction {\r\n  return async (req, res, next) => {\r\n    if (req.url === \"/\") {\r\n      const { root } = serverContext\r\n\r\n      // ÈªòËÆ§‰ΩøÁî®È°πÁõÆÊ†πÁõÆÂΩï‰∏ãÁöÑ index.html\r\n      const indexHtmlPath = path.join(root, \"index.html\")\r\n\r\n      if (await pathExists(indexHtmlPath)) {\r\n        const rawHtml = await readFile(indexHtmlPath, \"utf8\")\r\n\r\n        let html = rawHtml\r\n\r\n        // ÈÄöËøáÊâßË°åÊèí‰ª∂ÁöÑ transformIndexHtml ÊñπÊ≥ïÊù•ÂØπ HTML ËøõË°åËá™ÂÆö‰πâÁöÑ‰øÆÊîπ\r\n        for (const plugin of serverContext.plugins) {\r\n          if (plugin.transformIndexHtml) {\r\n            html = await plugin.transformIndexHtml(html)\r\n          }\r\n        }\r\n\r\n        res.statusCode = 200\r\n        res.setHeader(\"Content-Type\", \"text/html\")\r\n        return res.end(html)\r\n      }\r\n    }\r\n    \r\n    return next()\r\n  }\r\n}\r\n","import { NextHandleFunction } from \"connect\"\r\nimport {\r\n  isJSRequest,\r\n  isCSSRequest,\r\n  isImportRequest,\r\n  cleanUrl,\r\n} from \"../../utils\"\r\nimport { ServerContext } from \"../index\"\r\nimport createDebug from \"debug\"\r\n\r\nconst debug = createDebug(\"dev\")\r\n\r\nexport async function transformRequest(\r\n  url: string,\r\n  serverContext: ServerContext\r\n) {\r\n  const { pluginContainer } = serverContext\r\n\r\n  url = cleanUrl(url)\r\n  \r\n  // ÁÆÄÂçïÊù•ËØ¥ÔºåÂ∞±ÊòØ‰æùÊ¨°Ë∞ÉÁî®Êèí‰ª∂ÂÆπÂô®ÁöÑ resolveId„ÄÅload„ÄÅtransform ÊñπÊ≥ï\r\n  const resolvedResult = await pluginContainer.resolveId(url)\r\n\r\n  let transformResult\r\n\r\n  if (resolvedResult?.id) {\r\n    let code = await pluginContainer.load(resolvedResult.id)\r\n    if (typeof code === \"object\" && code !== null) {\r\n      code = code.code\r\n    }\r\n    if (code) {\r\n      transformResult = await pluginContainer.transform(\r\n        code as string,\r\n        resolvedResult?.id\r\n      )\r\n    }\r\n  }\r\n  return transformResult\r\n}\r\n\r\nexport function transformMiddleware(\r\n  serverContext: ServerContext\r\n): NextHandleFunction {\r\n  return async (req, res, next) => {\r\n    if (req.method !== \"GET\" || !req.url) {\r\n      return next()\r\n    }\r\n\r\n    const url = req.url\r\n\r\n    debug(\"transformMiddleware: %s\", url)\r\n\r\n    // transform JS request\r\n    if (isJSRequest(url) || isCSSRequest(url) || isImportRequest(url)) {\r\n      // Ê†∏ÂøÉÁºñËØëÂáΩÊï∞\r\n      let result = await transformRequest(url, serverContext)\r\n\r\n      if (!result) {\r\n        return next()\r\n      }\r\n      if (result && typeof result !== \"string\") {\r\n        result = result.code\r\n      }\r\n\r\n      // ÁºñËØëÂÆåÊàêÔºåËøîÂõûÂìçÂ∫îÁªôÊµèËßàÂô®\r\n      res.statusCode = 200\r\n      res.setHeader(\"Content-Type\", \"application/javascript\")\r\n      \r\n      return res.end(result)\r\n    }\r\n\r\n    next()\r\n  }\r\n}\r\n","import { NextHandleFunction } from \"connect\"\r\nimport { isImportRequest } from \"../../utils\"\r\n// ‰∏Ä‰∏™Áî®‰∫éÂä†ËΩΩÈùôÊÄÅËµÑÊ∫êÁöÑ‰∏≠Èó¥‰ª∂\r\nimport sirv from \"sirv\"\r\n\r\nexport function staticMiddleware(): NextHandleFunction {\r\n  const serveFromRoot = sirv(\"/\", { dev: true })\r\n\r\n  return async (req, res, next) => {\r\n    if (!req.url) {\r\n      return\r\n    }\r\n    // ‰∏çÂ§ÑÁêÜ import ËØ∑Ê±Ç\r\n    if (isImportRequest(req.url)) {\r\n      return\r\n    }\r\n\r\n    serveFromRoot(req, res, next)\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;AAAA,OAAO,SAAS;;;ACAhB,OAAO,aAAa;AACpB,SAAS,MAAM,SAAAA,cAAa;;;ACD5B,OAAOC,WAAU;AACjB,SAAS,aAAa;AACtB,SAAS,aAAa;;;ACFtB,OAAO,UAAU;AAEV,IAAM,iBAAiB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEO,IAAM,iBAAiB;AAGvB,IAAM,iBAAiB,KAAK,KAAK,gBAAgB,OAAO;AAExD,IAAM,cAAc;AACpB,IAAM,WAAW;AACjB,IAAM,UAAU;AAEhB,IAAM,qBAAqB,CAAC,QAAQ,OAAO,QAAQ,IAAI;;;AC9BvD,SAAS,WAAW,MAA2B;AACpD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,MAAMC,QAAO;AAEX,MAAAA,OAAM;AAAA,QACJ,EAAE,QAAQ,IAAI,OAAO,OAAO,eAAe,KAAK,GAAG,KAAK,EAAE;AAAA,QAC1D,CAAC,gBAAgB;AACf,iBAAO;AAAA,YACL,MAAM,YAAY;AAAA,YAElB,UAAU;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAEA,MAAAA,OAAM;AAAA,QACJ;AAAA,UACE,QAAQ;AAAA,QACV;AAAA,QACA,CAAC,gBAAgB;AACf,gBAAM,EAAE,MAAM,GAAG,IAAI;AAErB,eAAK,IAAI,EAAE;AACX,iBAAO;AAAA,YACL,MAAM;AAAA,YACN,UAAU;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;AC/BA,SAAS,MAAM,aAAa;AAC5B,OAAOC,WAAU;AAEjB,OAAO,aAAa;AAEpB,OAAO,QAAQ;AAEf,OAAO,iBAAiB;;;ACXxB,OAAOC,WAAU;AACjB,OAAO,QAAQ;AAGR,SAAS,MAAM,GAAmB;AACvC,SAAO,EAAE,QAAQ,OAAO,GAAG;AAC7B;AACO,IAAM,YAAY,GAAG,SAAS,MAAM;AAEpC,SAAS,cAAc,IAAoB;AAChD,SAAOC,MAAK,MAAM,UAAU,YAAY,MAAM,EAAE,IAAI,EAAE;AACxD;AAEO,IAAM,cAAc,CAAC,OAAwB;AAClD,OAAK,SAAS,EAAE;AAChB,MAAI,YAAY,KAAK,EAAE,GAAG;AACxB,WAAO;AAAA,EACT;AACA,MAAI,CAACA,MAAK,QAAQ,EAAE,KAAK,CAAC,GAAG,SAAS,GAAG,GAAG;AAC1C,WAAO;AAAA,EACT;AACA,SAAO;AACT;AAEO,IAAM,eAAe,CAAC,OAC3B,SAAS,EAAE,EAAE,SAAS,MAAM;AAEvB,IAAM,kBAAkB,CAAC,QAC9B,IAAI,SAAS,SAAS;AAEjB,IAAM,oBAAoB,CAAC,QAChC,IAAI,QAAQ,aAAa,EAAE;AAEtB,IAAM,WAAW,CAAC,QACvB,IAAI,QAAQ,SAAS,EAAE,EAAE,QAAQ,UAAU,EAAE;;;ADnB/C,IAAM,QAAQ,YAAY,KAAK;AAExB,SAAS,gBAAgB,MAA2B;AACzD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,MAAMC,QAAO;AACX,MAAAA,OAAM;AAAA,QACJ;AAAA,UACE,QAAQ;AAAA,QACV;AAAA,QACA,CAAC,gBAAgB;AACf,gBAAM,EAAE,MAAM,IAAI,SAAS,IAAI;AAC/B,gBAAM,UAAU,CAAC;AAGjB,cAAI,KAAK,IAAI,EAAE,GAAG;AAGhB,mBAAO,UACH;AAAA,cACE,MAAM;AAAA,cACN,WAAW;AAAA,YACb,IACA;AAAA,cAEE,MAAM,QAAQ,KAAK,IAAI,EAAE,SAAS,QAAQ,IAAI,EAAE,CAAC;AAAA,YACnD;AAAA,UACN;AAAA,QACF;AAAA,MACF;AAGA,MAAAA,OAAM;AAAA,QACJ;AAAA,UACE,QAAQ;AAAA,UACR,WAAW;AAAA,QACb;AAAA,QACA,OAAO,aAAa;AAClB,gBAAM;AAEN,gBAAM,KAAK,SAAS;AACpB,gBAAM,OAAO,QAAQ,IAAI;AAEzB,gBAAM,YAAY,QAAQ,KAAK,IAAI,EAAE,SAAS,KAAK,CAAC;AAEpD,gBAAM,OAAO,MAAM,GAAG,SAAS,WAAW,OAAO;AACjD,gBAAM,CAAC,SAAS,OAAO,IAAI,MAAM,MAAM,IAAI;AAE3C,cAAI,eAAe,cAAcC,MAAK,SAAS,MAAM,SAAS,CAAC;AAC/D,cACE,CAAC,aAAa,WAAW,IAAI,KAC7B,CAAC,aAAa,WAAW,KAAK,KAC9B,iBAAiB,KACjB;AACA,2BAAe,KAAK;AAAA,UACtB;AAEA,cAAI,cAAc,CAAC;AAGnB,cAAI,CAAC,QAAQ,UAAU,CAAC,QAAQ,QAAQ;AAEtC,kBAAM,MAAM,UAAQ;AACpB,kBAAM,aAAa,OAAO,KAAK,GAAG;AAClC,wBAAY;AAAA,cACV,YAAY,WAAW,KAAK,GAAG,aAAa;AAAA,cAC5C,2BAA2B;AAAA,YAC7B;AAAA,UACF,OAAO;AAEL,gBAAI,QAAQ,SAAS,SAAS,GAAG;AAC/B,0BAAY,KAAK,kBAAkB,+BAA+B;AAAA,YACpE;AACA,wBAAY,KAAK,kBAAkB,eAAe;AAAA,UACpD;AACA,gBAAM,4CAAc,YAAY,KAAK,IAAI,CAAC;AAC1C,gBAAM,SAASA,MAAK,QAAQ,SAAS,EAAE,MAAM,CAAC;AAE9C,iBAAO;AAAA,YACL;AAAA,YACA,UAAU,YAAY,KAAK,IAAI;AAAA,YAC/B,YAAY;AAAA,UACd;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;AH9FA,eAAsB,SAAS,MAAc;AAE3C,QAAM,QAAQC,MAAK,QAAQ,MAAM,cAAc;AAG/C,QAAM,OAAO,oBAAI,IAAY;AAE7B,QAAM,MAAM;AAAA,IACV,aAAa,CAAC,KAAK;AAAA,IACnB,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,SAAS,CAAE,WAAW,IAAI,CAAE;AAAA,EAC9B,CAAC;AAED,UAAQ;AAAA,IACN,GAAG,MAAM,kDAAU;AAAA,EAAO,CAAC,GAAG,IAAI,EACjC,IAAI,KAAK,EACT,IAAI,CAAC,SAAS,KAAK,MAAM,EACzB,KAAK,IAAI;AAAA,EACZ;AAGA,QAAM,MAAM;AAAA,IACV,aAAa,CAAC,GAAG,IAAI;AAAA,IACrB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,QAAQA,MAAK,QAAQ,MAAM,cAAc;AAAA,IACzC,SAAS,CAAC,gBAAgB,IAAI,CAAC;AAAA,EACjC,CAAC;AACH;;;AKvCA,OAAOC,cAAa;AACpB,OAAOC,WAAU;AACjB,SAAS,kBAAkB;AAOpB,SAAS,gBAAwB;AACtC,MAAI;AACJ,SAAO;AAAA,IACL,MAAM;AAAA,IACN,gBAAgB,GAAG;AAEjB,sBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,UAAU,IAAY,UAAmB;AAE7C,UAAIC,MAAK,WAAW,EAAE,GAAG;AACvB,YAAI,MAAM,WAAW,EAAE,GAAG;AACxB,iBAAO,EAAE,GAAG;AAAA,QACd;AAEA,aAAKA,MAAK,KAAK,cAAc,MAAM,EAAE;AACrC,YAAI,MAAM,WAAW,EAAE,GAAG;AACxB,iBAAO,EAAE,GAAG;AAAA,QACd;AAAA,MACF,WAES,GAAG,WAAW,GAAG,GAAG;AAC3B,YAAI,CAAC,UAAU;AACb,gBAAM,IAAI,MAAM,oCAAoC;AAAA,QACtD;AACA,cAAM,eAAeA,MAAK,QAAQ,EAAE,EAAE,SAAS;AAC/C,YAAI;AAGJ,YAAI,cAAc;AAChB,uBAAaC,SAAQ,KAAK,IAAI,EAAE,SAASD,MAAK,QAAQ,QAAQ,EAAE,CAAC;AACjE,cAAI,MAAM,WAAW,UAAU,GAAG;AAEhC,mBAAO,EAAE,GAAG;AAAA,UACd;AAAA,QACF,OAGK;AAEH,qBAAW,WAAW,oBAAoB;AACxC,gBAAI;AACF,oBAAM,gBAAgB,GAAG,KAAK;AAC9B,2BAAaC,SAAQ,KAAK,eAAe;AAAA,gBACvC,SAASD,MAAK,QAAQ,QAAQ;AAAA,cAChC,CAAC;AACD,kBAAI,MAAM,WAAW,UAAU,GAAG;AAEhC,uBAAO,EAAE,IAAI,cAAc;AAAA,cAC7B;AAAA,YACF,SAAS,GAAP;AACA;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;ACpEA,OAAO,aAAa;AACpB,OAAOE,WAAU;AACjB,SAAS,gBAAgB;AAKlB,SAAS,yBAAiC;AAC/C,SAAO;AAAA,IACL,MAAM;AAAA,IAEN,MAAM,KAAK,IAAI;AACb,UAAI,YAAY,EAAE,GAAG;AACnB,YAAI;AACF,gBAAM,OAAO,MAAM,SAAS,IAAI,OAAO;AACvC,iBAAO;AAAA,QACT,SAAS,GAAP;AACA,iBAAO;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAAA,IACA,MAAM,UAAU,MAAM,IAAI;AACxB,UAAI,YAAY,EAAE,GAAG;AACnB,cAAM,UAAUC,MAAK,QAAQ,EAAE,EAAE,MAAM,CAAC;AACxC,cAAM,EAAE,MAAM,iBAAiB,IAAI,IAAI,MAAM,QAAQ,UAAU,MAAM;AAAA,UACnE,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,WAAW;AAAA,UACX,QAAQ;AAAA,QACV,CAAC;AACD,eAAO;AAAA,UACL,MAAM;AAAA,UACN;AAAA,QACF;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;ACpCA,OAAOC,WAAU;AAEjB,OAAO,iBAAiB;AACxB,SAAS,QAAAC,OAAM,SAAAC,cAAa;AAiBrB,SAAS,uBAA+B;AAC7C,MAAI;AACJ,SAAO;AAAA,IACL,MAAM;AAAA,IACN,gBAAgB,GAAG;AAEjB,sBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,UAAU,MAAc,IAAY;AAExC,UAAI,CAAC,YAAY,EAAE,GAAG;AACpB,eAAO;AAAA,MACT;AACA,YAAMC;AAEN,YAAM,CAAC,OAAO,IAAIC,OAAM,IAAI;AAC5B,YAAM,KAAK,IAAI,YAAY,IAAI;AAE/B,iBAAW,cAAc,SAAS;AAGhC,cAAM,EAAE,GAAG,UAAU,GAAG,QAAQ,GAAG,UAAU,IAAI;AAEjD,YAAI,CAAC;AAAW;AAGhB,YAAI,UAAU,SAAS,MAAM,GAAG;AAE9B,gBAAM,SAAS,GAAG,MAAM,IAAI,EAAE,GAAG,EAAE;AACnC,gBAAM,cAAc,cAAcC,MAAK,KAAK,KAAK,QAAQ,SAAS,CAAC;AAEnE,aAAG,UAAU,UAAU,QAAQ,GAAG,oBAAoB;AACtD;AAAA,QACF;AAGA,YAAI,eAAe,KAAK,SAAS,GAAG;AAMlC,gBAAM,aAAa;AAAA,YACjBA,MAAK,KAAK,KAAK,gBAAgB,GAAG,cAAc;AAAA,UAClD;AACA,aAAG,UAAU,UAAU,QAAQ,UAAU;AAAA,QAC3C,WAAW,UAAU,WAAW,GAAG,KAAK,UAAU,WAAW,GAAG,GAAG;AAEjE,gBAAM,WAAW,MAAM,KAAK,QAAQ,WAAW,EAAE;AACjD,cAAI,UAAU;AACZ,eAAG,UAAU,UAAU,QAAQ,SAAS,EAAE;AAAA,UAC5C;AAAA,QACF;AAAA,MACF;AAEA,aAAO;AAAA,QACL,MAAM,GAAG,SAAS;AAAA,QAElB,KAAK,GAAG,YAAY;AAAA,MACtB;AAAA,IACF;AAAA,EACF;AACF;;;ACpFA,SAAS,YAAAC,iBAAgB;AAGlB,SAAS,YAAoB;AAClC,SAAO;AAAA,IACL,MAAM;AAAA,IACN,KAAK,IAAI;AAEP,UAAI,GAAG,SAAS,MAAM,GAAG;AACvB,eAAOA,UAAS,IAAI,OAAO;AAAA,MAC7B;AAAA,IACF;AAAA,IAEA,MAAM,UAAU,MAAM,IAAI;AACxB,UAAI,GAAG,SAAS,MAAM,GAAG;AAEvB,cAAM,YAAY;AAAA,yBACD,KAAK,QAAQ,OAAO,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,8BAKjB,KAAK;AAC3B,eAAO;AAAA,UACL,MAAM;AAAA,QACR;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;AC3BO,SAAS,cAAsB;AACpC,SAAO;AAAA,IACL,MAAM;AAAA,IACN,MAAM,KAAK,IAAI;AACb,UAAI,YAAY,kBAAkB,SAAS,EAAE,CAAC;AAE9C,UAAI,UAAU,SAAS,MAAM,GAAG;AAC9B,YAAI,WAAW;AACb,sBAAY,UAAU,QAAQ,QAAQ,EAAE,EAAE,QAAQ,OAAO,MAAM;AAAA,QACjE;AAEA,eAAO;AAAA,UAEL,MAAM,mBAAmB;AAAA,QAC3B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;ACbO,SAAS,iBAA2B;AACzC,SAAO;AAAA,IACL,cAAc;AAAA,IACd,uBAAuB;AAAA,IACvB,qBAAqB;AAAA,IACrB,UAAU;AAAA,IACV,YAAY;AAAA,EACd;AACF;;;ACFO,IAAM,wBAAwB,CAAC,YAAuC;AAG3E,QAAM,QAAuC;AAAA,IAE3C,MAAM,QAAQ,IAAY,UAAmB;AAC3C,UAAI,MAAM,MAAM,gBAAgB,UAAU,IAAI,QAAQ;AACtD,UAAI,OAAO,QAAQ;AAAU,cAAM,EAAE,IAAI,IAAI;AAC7C,aAAO;AAAA,IACT;AAAA,EACF;AAGA,QAAM,kBAAmC;AAAA,IACvC,MAAM,UAAU,IAAY,UAAmB;AAC7C,YAAM,MAAM,IAAI,QAAQ;AACxB,iBAAW,UAAU,SAAS;AAC5B,YAAI,OAAO,WAAW;AACpB,gBAAM,QAAQ,MAAM,OAAO,UAAU,KAAK,KAAY,IAAI,QAAQ;AAClE,cAAI,OAAO;AACT,iBAAK,OAAO,UAAU,WAAW,QAAQ,MAAM;AAC/C,mBAAO,EAAE,GAAG;AAAA,UACd;AAAA,QACF;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,IACA,MAAM,KAAK,IAAI;AACb,YAAM,MAAM,IAAI,QAAQ;AACxB,iBAAW,UAAU,SAAS;AAC5B,YAAI,OAAO,MAAM;AACf,gBAAM,SAAS,MAAM,OAAO,KAAK,KAAK,KAAK,EAAE;AAC7C,cAAI,QAAQ;AACV,mBAAO;AAAA,UACT;AAAA,QACF;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,IACA,MAAM,UAAU,MAAM,IAAI;AACxB,YAAM,MAAM,IAAI,QAAQ;AACxB,iBAAW,UAAU,SAAS;AAC5B,YAAI,OAAO,WAAW;AACpB,gBAAM,SAAS,MAAM,OAAO,UAAU,KAAK,KAAK,MAAM,EAAE;AACxD,cAAI,CAAC;AAAQ;AACb,cAAI,OAAO,WAAW,UAAU;AAC9B,mBAAO;AAAA,UACT,WAAW,OAAO,MAAM;AACtB,mBAAO,OAAO;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AACA,aAAO,EAAE,KAAK;AAAA,IAChB;AAAA,EACF;AAEA,SAAO;AACT;;;ACtEA,OAAOC,WAAU;AACjB,SAAS,cAAAC,aAAY,YAAAC,iBAAgB;AAG9B,SAAS,kBACd,eACoB;AACpB,SAAO,OAAO,KAAK,KAAK,SAAS;AAC/B,QAAI,IAAI,QAAQ,KAAK;AACnB,YAAM,EAAE,KAAK,IAAI;AAGjB,YAAM,gBAAgBF,MAAK,KAAK,MAAM,YAAY;AAElD,UAAI,MAAMC,YAAW,aAAa,GAAG;AACnC,cAAM,UAAU,MAAMC,UAAS,eAAe,MAAM;AAEpD,YAAI,OAAO;AAGX,mBAAW,UAAU,cAAc,SAAS;AAC1C,cAAI,OAAO,oBAAoB;AAC7B,mBAAO,MAAM,OAAO,mBAAmB,IAAI;AAAA,UAC7C;AAAA,QACF;AAEA,YAAI,aAAa;AACjB,YAAI,UAAU,gBAAgB,WAAW;AACzC,eAAO,IAAI,IAAI,IAAI;AAAA,MACrB;AAAA,IACF;AAEA,WAAO,KAAK;AAAA,EACd;AACF;;;AC3BA,OAAOC,kBAAiB;AAExB,IAAMC,SAAQD,aAAY,KAAK;AAE/B,eAAsB,iBACpB,KACA,eACA;AACA,QAAM,EAAE,gBAAgB,IAAI;AAE5B,QAAM,SAAS,GAAG;AAGlB,QAAM,iBAAiB,MAAM,gBAAgB,UAAU,GAAG;AAE1D,MAAI;AAEJ,MAAI,gBAAgB,IAAI;AACtB,QAAI,OAAO,MAAM,gBAAgB,KAAK,eAAe,EAAE;AACvD,QAAI,OAAO,SAAS,YAAY,SAAS,MAAM;AAC7C,aAAO,KAAK;AAAA,IACd;AACA,QAAI,MAAM;AACR,wBAAkB,MAAM,gBAAgB;AAAA,QACtC;AAAA,QACA,gBAAgB;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT;AAEO,SAAS,oBACd,eACoB;AACpB,SAAO,OAAO,KAAK,KAAK,SAAS;AAC/B,QAAI,IAAI,WAAW,SAAS,CAAC,IAAI,KAAK;AACpC,aAAO,KAAK;AAAA,IACd;AAEA,UAAM,MAAM,IAAI;AAEhB,IAAAC,OAAM,2BAA2B,GAAG;AAGpC,QAAI,YAAY,GAAG,KAAK,aAAa,GAAG,KAAK,gBAAgB,GAAG,GAAG;AAEjE,UAAI,SAAS,MAAM,iBAAiB,KAAK,aAAa;AAEtD,UAAI,CAAC,QAAQ;AACX,eAAO,KAAK;AAAA,MACd;AACA,UAAI,UAAU,OAAO,WAAW,UAAU;AACxC,iBAAS,OAAO;AAAA,MAClB;AAGA,UAAI,aAAa;AACjB,UAAI,UAAU,gBAAgB,wBAAwB;AAEtD,aAAO,IAAI,IAAI,MAAM;AAAA,IACvB;AAEA,SAAK;AAAA,EACP;AACF;;;ACtEA,OAAO,UAAU;AAEV,SAAS,mBAAuC;AACrD,QAAM,gBAAgB,KAAK,KAAK,EAAE,KAAK,KAAK,CAAC;AAE7C,SAAO,OAAO,KAAK,KAAK,SAAS;AAC/B,QAAI,CAAC,IAAI,KAAK;AACZ;AAAA,IACF;AAEA,QAAI,gBAAgB,IAAI,GAAG,GAAG;AAC5B;AAAA,IACF;AAEA,kBAAc,KAAK,KAAK,IAAI;AAAA,EAC9B;AACF;;;AfAA,eAAsB,iBAAiB;AACrC,QAAM,MAAM,QAAQ;AACpB,QAAM,OAAO,QAAQ,IAAI;AACzB,QAAM,YAAY,KAAK,IAAI;AAE3B,QAAM,UAAU,eAAe;AAC/B,QAAM,kBAAkB,sBAAsB,OAAO;AAErD,QAAM,gBAA+B;AAAA,IACnC,MAAM,QAAQ,IAAI;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,aAAW,UAAU,SAAS;AAC5B,QAAI,OAAO,iBAAiB;AAC1B,YAAM,OAAO,gBAAgB,aAAa;AAAA,IAC5C;AAAA,EACF;AAGA,MAAI,IAAI,oBAAoB,aAAa,CAAC;AAE1C,MAAI,IAAI,kBAAkB,aAAa,CAAC;AAExC,MAAI,IAAI,iBAAiB,CAAC;AAE1B,MAAI,OAAO,KAAM,YAAY;AAC3B,UAAM,SAAS,IAAI;AAEnB,YAAQ;AAAA,MACNC,OAAM,uEAAwB;AAAA,MAC9B,iBAAO,KAAK,IAAI,IAAI;AAAA,IACtB;AACA,YAAQ,IAAI,2CAAa,KAAK,uBAAuB,GAAG;AAAA,EAC1D,CAAC;AACH;;;ADrDA,IAAM,MAAM,IAAI;AAEhB,IACG,QAAQ,UAAU,4BAA4B,EAC9C,MAAM,OAAO,EACb,MAAM,KAAK,EACX,OAAO,YAAY;AAClB,QAAM,eAAe;AACvB,CAAC;AAEH,IAAI,KAAK;AAET,IAAI,MAAM;","names":["green","path","build","path","path","path","build","path","path","resolve","path","path","resolve","path","path","path","init","parse","init","parse","path","readFile","path","pathExists","readFile","createDebug","debug","green"]}